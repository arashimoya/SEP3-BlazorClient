@page "/branches"
@using ABDOTClient.Model
@using ABDOTClient.Data
@inject NavigationManager NavigationManager

<style>
    html, body {
        background-color: white;
        color: black;
    }
    .confirmation-message{
        color: greenyellow;
    }
</style>
<p class="confirmation-message">@confirmationMessage</p>
@if (branchesToShow == null)
{
    <p>
        <em>Loading...</em>
    </p>
} else if (!branchesToShow.Any()){
    <p>
        <em>No Branch items exist. Please add some</em>
    </p>
}
else
{
    <div class="container" style="background-color: white">
        <div class="section-separate" style="padding-top:40px">
            <button style="border-color: transparent; background-color:transparent">
            <i class="oi oi-arrow-left" @onclick="@(()=>NavigationManager.NavigateTo("/admin"))"/>
            </button>
        </div>
    <h3 style="color:black">BranchList</h3>
        <p style="color:black">for owners only //or give authentication for edit/remove actions</p>
        <div class="row">
            <div class="col-sm-4" @onclick="@(()=> NavigationManager.NavigateTo("/addmovie"))"><button>
                <i class="oi oi-plus"/>
            </button>
                </div>
        </div>
    <table class="table" style="color:black; border-color: black">
        <thead>
        <tr>
            <th>ID</th>
            <th>City</th>
            <th>Halls</th>
            
                <th>Remove</th>
                <th>Edit</th>
            
        </tr>
        </thead>
        <tbody>
        @foreach (var item in branchesToShow)
        {
            <tr>
                <td>@item.Id</td>
                <td>@item.City</td>
                <td>@foreach (var hall in @item.Halls)
                    {
                        <a href="/hall/{hall.id}">Hall @hall.Id</a><br/>
                    }</td>
                
                    <td>
                        <button @onclick="@(() => RemoveBranch(item))">
                            <i class="oi oi-trash" style="color:red"/>
                        </button>
                    </td>
                    <td>
                        <button @onclick="@(() => Edit(item.Id))">
                            <i class="oi oi-pencil" style="color:blue"/>
                        </button>
                    </td>
                
            </tr>
        }
        </tbody>
    </table>
    </div>
}
@code {
    private IList<Branch> branches;
    private IList<Branch> branchesToShow;
    private IBranchService BranchService = new BranchCloudService();
    private string confirmationMessage="";

    protected override async Task OnInitializedAsync()
    {
        
        branches = new List<Branch>();
        if (!branches.Any())
        {
            branches = await BranchService.GetAllBranches();
        }
        branchesToShow = branches;
    }
    private async Task RemoveBranch(Branch branch)
    {
        if (await BranchService.DeleteBranch(branch))
            confirmationMessage = "Branch deleted successfully";
    }

    private void Edit(int id)
    {
        NavigationManager.NavigateTo($"EditBranch/{id}");
    }

    

}